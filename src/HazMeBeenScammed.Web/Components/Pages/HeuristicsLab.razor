@page "/heuristics-lab"
@rendermode InteractiveServer

<PageTitle>Scam Detection Lab</PageTitle>

<div class="lab-hero">
    <h1>Scam Detection Lab</h1>
    <p>
        A scientific field guide to how this app detects sketchy Ethereum behavior,
        explained like you are five where it helps üß™üß†.
    </p>
</div>

<div class="lab-layout">
    <section class="lab-card">
        <h2>Method</h2>
        <ul>
            <li><strong>Heuristics</strong> = quick pattern alarms ‚ö°</li>
            <li><strong>Verifiable on-chain checks</strong> = provable evidence from chain data üßæ</li>
        </ul>
        <p>
            Score model:
            <code>finalScore = heuristicScore * 0.45 + verifiableScore * 0.55</code>
        </p>
        <p>
            ELI5: your friend says "hmm weird" and the camera confirms it.
            We trust the camera a bit more üì∑
        </p>
    </section>

    <section class="lab-card">
        <h2>Verdict Bands</h2>
        <div class="verdict-grid">
            <div class="verdict verdict-clean">
                <strong>0-14</strong>
                <span>Clean ‚úÖ</span>
            </div>
            <div class="verdict verdict-suspicious">
                <strong>15-39</strong>
                <span>Suspicious ‚ö†Ô∏è</span>
            </div>
            <div class="verdict verdict-likely">
                <strong>40-69</strong>
                <span>Likely Scam üö®</span>
            </div>
            <div class="verdict verdict-confirmed">
                <strong>70-100</strong>
                <span>Confirmed Scam ‚ò†Ô∏è</span>
            </div>
        </div>
    </section>

    <section class="lab-card">
        <h2>Signal Matrix (Science + ELI5)</h2>
        <div class="lab-matrix-wrap">
            <table class="lab-matrix">
                <thead>
                    <tr>
                        <th>Signal</th>
                        <th>Scientific Test</th>
                        <th>ELI5</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Counterparty concentration</td>
                        <td>Top counterparties > 60% of interactions.</td>
                        <td>All candy keeps going to one kid üç¨</td>
                        <td><span class="lab-tag tag-heuristic">Heuristic</span></td>
                    </tr>
                    <tr>
                        <td>Wallet age anomaly</td>
                        <td>Wallet younger than 7 days with high-value transfers.</td>
                        <td>Brand-new account acting rich on day one üé≠</td>
                        <td><span class="lab-tag tag-heuristic">Heuristic</span></td>
                    </tr>
                    <tr>
                        <td>Failed transaction spike</td>
                        <td>Failure ratio above 40% over recent activity.</td>
                        <td>Someone keeps trying wrong keys üîë</td>
                        <td><span class="lab-tag tag-heuristic">Heuristic</span></td>
                    </tr>
                    <tr>
                        <td>Proxy upgradeability risk</td>
                        <td>Read EIP-1967 implementation slot and verify implementation code.</td>
                        <td>Check if the puppet has a hidden puppeteer üéé</td>
                        <td><span class="lab-tag tag-verified">Verifiable</span></td>
                    </tr>
                    <tr>
                        <td>Approval -> drain correlation</td>
                        <td>Approval event followed by rapid outflow in a short time window.</td>
                        <td>You gave a key, toys disappeared fast üóùÔ∏è‚û°Ô∏èüï≥Ô∏è</td>
                        <td><span class="lab-tag tag-verified">Verifiable</span></td>
                    </tr>
                    <tr>
                        <td>Event log anomaly</td>
                        <td>Successful call but missing expected approval/transfer-style logs.</td>
                        <td>Receipt says paid, scanner never beeped üßæ</td>
                        <td><span class="lab-tag tag-verified">Verifiable</span></td>
                    </tr>
                    <tr>
                        <td>Bytecode similarity risk</td>
                        <td>Code shape and size resemble known drainer templates.</td>
                        <td>Same costume, same villain moves ü¶π</td>
                        <td><span class="lab-tag tag-verified">Verifiable</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p class="lab-footnote">
            Example RPC proof primitives: <code>eth_getCode</code>, <code>eth_getStorageAt</code>, <code>eth_getTransactionReceipt</code>
        </p>
    </section>

    <section class="lab-card">
        <h2>Confidence and Evidence</h2>
        <p>Each indicator stores confidence and chain evidence.</p>
        <ul>
            <li><strong>Low</strong>: weak clue ü§è</li>
            <li><strong>Medium</strong>: useful clue üß©</li>
            <li><strong>High</strong>: strong clue üéØ</li>
            <li><strong>Verified</strong>: chain-proven fact üìå</li>
        </ul>
        <p>
            Evidence examples: tx hash, selector, storage slot, log topic, contract address.
        </p>
    </section>

    <section class="lab-card">
        <h2>Engine Pipeline</h2>
        <ol>
            <li>Fetch transactions and contract metadata.</li>
            <li>Run fast heuristics.</li>
            <li>Run on-chain verification calls.</li>
            <li>Attach confidence + evidence.</li>
            <li>Compute weighted score and verdict.</li>
            <li>Stream progress and deep counterparty analysis.</li>
        </ol>
        <p>ELI5: quick look -> detective look -> microscope look üîçüïµÔ∏è‚Äç‚ôÇÔ∏èüî¨</p>
    </section>

    <section class="lab-card">
        <h2>Methods Appendix (Exact Thresholds)</h2>
        <div class="lab-matrix-wrap">
            <table class="lab-matrix">
                <thead>
                    <tr>
                        <th>Rule</th>
                        <th>Current Value</th>
                        <th>Where Used</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Counterparty concentration</td>
                        <td><code>&gt; 0.60</code> with at least <code>6</code> counterparties</td>
                        <td>Portfolio heuristic</td>
                    </tr>
                    <tr>
                        <td>Wallet age anomaly</td>
                        <td>wallet age <code>&lt;= 7 days</code> and any tx <code>&gt;= 10 ETH</code></td>
                        <td>Portfolio heuristic</td>
                    </tr>
                    <tr>
                        <td>Failed transaction spike</td>
                        <td>failed ratio <code>&gt; 0.40</code> with at least <code>6</code> tx</td>
                        <td>Portfolio heuristic</td>
                    </tr>
                    <tr>
                        <td>Approval-drain window</td>
                        <td>outflow within <code>15 min</code> and value <code>&gt;= 0.5 ETH</code></td>
                        <td>Verifiable correlation</td>
                    </tr>
                    <tr>
                        <td>Bytecode template risk</td>
                        <td>bytecode string length <code>&lt; 260</code></td>
                        <td>Verifiable contract profile</td>
                    </tr>
                    <tr>
                        <td>Tx scan cap (receipt checks)</td>
                        <td>first <code>80</code> tx only</td>
                        <td>Performance guardrail</td>
                    </tr>
                    <tr>
                        <td>Contract scan cap</td>
                        <td>first <code>20</code> distinct contract addresses</td>
                        <td>Performance guardrail</td>
                    </tr>
                    <tr>
                        <td>Proxy slot</td>
                        <td><code>0x360894a13ba1...d382bbc</code> (EIP-1967 implementation slot)</td>
                        <td>Verifiable proxy check</td>
                    </tr>
                    <tr>
                        <td>High-risk selector flag</td>
                        <td>input starts with <code>0xb6f9de95</code></td>
                        <td>Selector anomaly check</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p class="lab-footnote">
            Score multipliers by confidence: <code>Low=0.6</code>, <code>Medium=1.0</code>, <code>High=1.25</code>, <code>Verified=1.5</code>.
        </p>
        <p class="lab-footnote">
            Last synced from analyzer logic in
            <code>src/HazMeBeenScammed.Core/Services/ScamAnalyzer.cs</code>
            and model metadata in
            <code>src/HazMeBeenScammed.Core/Domain/Models.cs</code>.
        </p>
    </section>
</div>
